<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>安逸今天吃什么</title>

    <meta name="description" content="别再问爷下顿吃什么了！！">
    <meta name="keywords" content="">
    <meta name="baidu-tc-verification" content="3e8294dabe46e8def7d4b790be59d4cc">

    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.7.2.custom.css">
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.7.2.custom.min.js"></script>

    <style type="text/css">
        table {
            margin: 12px auto;
            border-collapse: collapse;
            width: 95%;
        }

        th,
        td {
            border: 2px solid #f60;
        }

        label {
            margin: 6px 0;
            font-size: 14px;
            font-weight: bold;
            display: block;
        }

        input[type=text] {
            width: 600px;
        }

        input {
            width: expression(this.type=="text"?"600px":"auto");
        }

        textarea {
            width: 600px;
        }

        #main {
            color: #f8f8ff;
            margin: 0 auto;
            padding-top: 40px;
            width: 980px;
        }

        #event_title {
            color: #f60;
            margin: 26px;
            padding: 0;
            font-size: 56px;
            text-align: center;
        }

        #event_title span {
            padding: 0 32px;
        }

        #rolling_board {
            color: #000;
            line-height: 40px;
            font-size: 40px;
            font-weight: bold;
            margin: 34px auto;
            padding: 8px;
            width: 640px;
            text-align: center;
            background: #dcdcdc;
            border: 6px solid #03f;
        }

        #current_step {
            line-height: 42px;
            font-size: 42px;
            font-weight: bold;
        }

        #tabs {
            padding: 0;
        }

        #tabs-1 {
            padding: 4px;
            font-size: 14px;
            text-align: center;
            border: 3px solid #33f;
            height: 580px;
        }

        #tabs-2,
        #tabs-3,
        #tabs-4 {
            padding: 4px;
            border: 1px solid #ccc;
        }

        #tabs-3 h3,
        #tabs-4 h3 {
            padding-left: 6px;
            border-left: 6px solid #c00;
        }

        #tabs-4 h2 {
            text-align: center;
        }

        #rotate_div {
            padding-top: 60px;
            height: 400px;
        }

        #print_box {
            margin-top: 30px;
            font-weight: bold;
            font-size: 28px;
            width: 70%;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }

        #print_box span {
            margin: 4px;
            color: #fff;
        }
    </style>


     <style type="text/css">
.login-button { /* 按钮美化 */
	width: 270px; /* 宽度 */
	height: 40px; /* 高度 */
	border-width: 0px; /* 边框宽度 */
	border-radius: 3px; /* 边框半径 */
	background: #1E90FF; /* 背景颜色 */
	cursor: pointer; /* 鼠标移入按钮范围时出现手势 */
	outline: none; /* 不显示轮廓线 */
	font-family: Microsoft YaHei; /* 设置字体 */
	color: white; /* 字体颜色 */
	font-size: 17px; /* 字体大小 */
}
.login-button:hover { /* 鼠标移入按钮范围时改变颜色 */
	background: #5599FF;
}
    </style>

</head>

<body class="bg index" onLoad="document.getElementById('enter').focus()">
    <div id="container">
        <div id="wrapper" class="mh">
            <h1 style="text-align: center">别再问爷下顿吃什么了，爷下顿就吃这个！</h1>
            <div class="h20"></div>

     



            <script type="text/javascript">
                var game;

                $(function() {
                    $('#loading').hide();
                    $('#tabs').slideDown('fast');
                    $('#tabs').tabs();

                    game = new Game();
                    save_setting();
                });

                // 绑定回车键盘操作
                $(document).keypress(function(e) {
                    switch (e.which) {
                        case 13:
                            game.process();
                            break;
                    }
                });
            </script>

            <div id="main">
                <div id="loading" style="text-align: center; display: none;">
                    <h2>Loading...</h2>
                </div>

                <div id="tabs" style="display: block;" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
                <a href="#tabs-1" style="display: none">选餐</a>

                    <div id="tabs-1" style="background: url(&quot;images/thx2199.jpg&quot;) center center no-repeat;" class="ui-tabs-panel ui-widget-content ui-corner-bottom">
                        <h1 id="event_title"><span>选餐</span></h1>
                        <div id="rotate_div" style="display: block;">
                            <div><span id="current_step" style="display: none;">原来你也是个干饭人</span></div>
                            <div id="rolling_board" style="display: none;"><span style="color: #f33">吉师美食</span></div>
                            <div id="print_box" style="display: block;">请按回车键开始</div>
	        </div>
                    </div>
                    <!-- /#tabs-1 -->

                    <div id="tabs-2" style="background: #fff;" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">
                        <label>你也是个干饭人</label>
                        <div><input type="text" name="title" value="丨校园美食丨"></div>

                        <label>菜谱</label>
                        <div>每行一个奖项, 格式为竖线分隔的: 奖项名|数量|每次抽几个|奖品</div>
                        <textarea name="prizes" rows="6" cols="84">
中餐|1|1|
晚餐|1|1|
                        </textarea>

                        <label>候选菜列表</label>
                        <div>每行一道, 或半角逗号分隔</div>
                        <textarea name="candidates" rows="6" cols="84">
三三馋嘴鱼
三三脆皮鸡
三三烤肉饭
三三蛋炒饭
三三凉拌面
三三坩埚饭
三一汉堡
三一炸鸡
三一热面
三一油泼面
三一小米村
三一卷饼
三一麻辣拌
三一羊杂汤
三一石锅饭
一三萌锅饭
一三烤鸭
一三红烧肉
一三干锅饭
一三日月潭
一三米粉
一三咖喱饭
一三水饺
一一自营
一一自营
                        </textarea>

                        <label>跳动时间间隔</label>
                        <div><input type="text" name="interval" value="50" style="width: 50px;"> ms</div>

                        <label>背景图片</label>
                        <div>可以输入图片链接使用网络上的图片, 也可以把图片拷贝到当前目录, 把图片文件名填入即可.</div>
                        <div><input name="background_image" type="text" value="images/thx2199.jpg"></div>


                        <p><input type="button" value="保存" onclick="save_setting()"></p>
                    </div>
                    <!-- /#tabs-2 -->


                    <div id="tabs-4" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide">
                        <p>在浏览器上运行的干饭人专用小程序</p>

                        <h3>操作方便</h3>
                        <p>选餐过程键盘操作，只需要按回车键即可，非常方便。</p>

                        <h3>选餐流程</h3>
                        <p>只需要等待开始，闭眼，按回车，睁眼，按回车，十分灵活。</p>
                    </div>
                    <!-- /#tabs-4 -->
                </div>

                <script type="text/javascript">
                    function in_array(item, list) {
                        for (var i = 0; i < list.length; i++) {
                            if (item == list[i]) {
                                return true;
                            }
                        }
                        return false;
                    }

                    /**
                     * 返回指定元素在数组中的索引, 如果没找到, 返回-1;
                     */
                    function array_find(list, item) {
                        for (var i = 0; i < list.length; i++) {
                            if (item == list[i]) {
                                return i;
                            }
                        }
                        return -1;
                    }

                    // 从数组中删除元素. 返回新数组.
                    function array_del(list, item) {
                        var arr = [];
                        for (var i = 0; i < list.length; i++) {
                            if (item != list[i]) {
                                arr.push(list[i]);
                            }
                        }
                        return arr;
                    }

                    // 从数组中删除元素. 返回新数组.
                    function array_del_all(list, items) {
                        var arr = [];
                        for (var i = 0; i < list.length; i++) {
                            if (array_find(items, list[i]) == -1) {
                                arr.push(list[i]);
                            }
                        }
                        return arr;
                    }

                    /**
                     * 把数组当作环形的, 返回从start开始, 一共count个元素.
                     * 如果count大于数组长度, 返回整个数组.
                     */
                    function array_slice(list, start, count) {
                        var ret;

                        ret = list.slice(start, start + count);
                        if (ret.length < count) {
                            ret = ret.concat(list.slice(0, count - ret.length));
                        }

                        return ret;
                    }

                    // 扰乱数组元素的顺序.
                    function array_shuffle(list) {
                        var len = list.length;
                        for (var i = 0; i < len * 5; i++) {
                            var p1 = parseInt(len * Math.random());
                            var p2 = parseInt(len * Math.random());
                            var tmp = list[p1];
                            list[p1] = list[p2];
                            list[p2] = tmp;
                        }
                    }

                    var Game = function() {
                        var self = this;

                        this.step = -1;
                        this.interval = 100;
                        this.rotate_index = 0;
                        self.action = 'open';

                        this.prizes = [];
                        this.candidates = [];
                        this.results = [];

                        this.init = function() {
                            this.step = 0;
                            this.stop = false;
                            this.rotate_index = 0;
                            self.action = 'open';
                            this.results = [];

                            for (var i = 0; i < self.prizes.length; i++) {
                                var p = self.prizes[i];
                                self.results[i] = [];
                            }

                            show_current_step('');
                            var str = '请按回车';
                            str += '<br/><br/>';
                            print_box('请按回车键开始');
                            $('#rolling_board').hide();
                            $('#rotate_div').css('background', '');
                        }

                        this.reset = function() {
                            this.prizes = [];
                            this.candidates = [];
                            this.results = [];
                        }

                        this.process = function() {
                            show_results();

                            // 先更新状态再执行函数
                            switch (self.action) {
                                case 'open':
                                    self.action = 'step_open';
                                    $('#rotate_div').hide();
                                    on_open();
                                    $('#rotate_div').fadeIn('slow');
                                    break;
                                case 'close':
                                    self.action = '';
                                    on_close();
                                    break;
                                case 'step_open':
                                    self.action = 'rotate_start';
                                    $('#rotate_div').hide();
                                    on_step_open();
                                    $('#rotate_div').fadeIn('fast');
                                    break;
                                case 'step_close':
                                    if (self.step == self.prizes.length) {
                                        self.action = 'close';
                                    } else {
                                        self.action = 'step_open';
                                    }
                                    on_step_close();
                                    break;
                                case 'rotate_start':
                                    self.action = 'rotate_stop';
                                    on_rotate_start();
                                    break;
                                case 'rotate_stop':
                                    on_rotate_stop();
                                    break;
                                default:
                                    save_setting();
                                    break;
                            }
                        };
                    }

	    function on_open() {
                        show_current_step('菜谱已经重新打乱');
                        print_box('请再按一次回车键');
                    }


                    function on_close() {
                        show_current_step('');
                        $('#print_box').hide();
                        var str = '';
                        str += '<span><b style="font-size: 62px;">爷不满意</b><span><br/>';
                        print_box(str);
                        $('#print_box').fadeIn('slow');
                    }

                    function on_step_open() {
                        show_current_step();
                        print_box('按回车键开始');
                        $('#rolling_board').html('...');
                    }

                    function on_step_close() {
                        var str = '';
                        str += '<span>&nbsp;~** 下顿就吃 **~&nbsp;';
                        var r = game.results[game.step - 1];
                        for (var n = 0; n < r.length; n++) {
                            if(n % 2 == 0){
                                str += '<br/>' + r[n];
                            }else{
                                str += '&nbsp;|&nbsp;' + r[n];
                            }
                        }
                        str += '</span>';

                        print_box(str);
                        $('#rolling_board').slideUp('normal');
                    }

                    function on_rotate_start() {
                        $('#rolling_board').slideDown('normal');

                        game.interval = parseInt($('input[name=interval]').val());

                        game.stop = false;
                        game.rotate_index = 0;

                        // 打乱顺序
                        array_shuffle(game.candidates);

                        rotate_run();

                        show_current_step();
                        print_box('按回车键停止');
                    }


                    function on_rotate_stop() {
                        // 等一段随机时间再停止.
                        game.interval += parseInt(0.9 * game.interval);
                        setTimeout('game.stop=true', 230 + parseInt(230 * Math.random()));
                        game.stop = true;
                    }


                    function rotate_run() {
                        var num_a = game.prizes[game.step].num_a_time;
                        var size = game.prizes[game.step].num - game.results[game.step].length;
                        if (size > num_a) {
                            size = num_a;
                        }

                        var arr = array_slice(game.candidates, game.rotate_index, size);
                        $('#rolling_board').html(arr.join(' '));

                        game.rotate_index += num_a;
                        if (game.rotate_index >= game.candidates.length) {
                            game.rotate_index -= game.candidates.length;
                        }

                        if (game.stop) {
                            game.action = 'rotate_start';

                            game.results[game.step] = game.results[game.step].concat(arr);
                            game.candidates = array_del_all(game.candidates, arr);

                            show_results();
                            print_box('按回车键继续');

                            if (game.results[game.step].length == game.prizes[game.step].num) {
                                game.step++;
                                game.action = 'step_close';
                            }

                            var h = '<span style="color: #f33">' + $('#rolling_board').html() + '</span>';
                            $('#rolling_board').html(h)
                        } else {
                            setTimeout('rotate_run()', game.interval);
                        }
                    }


                    function show_current_step(str) {
                        if (str == undefined) {
                            var found = game.results[game.step].length;
                            var all = game.prizes[game.step].num;
                            var num_a = game.prizes[game.step].num_a_time;
                            var b = (num_a + found) > all ? all : (num_a + found);

                            var str = game.prizes[game.step].name;// + '(' + game.prizes[game.step].num + '顿';
                            //if (num_a != all) {
                              //  str += ', ' + (found + 1) + '-' + b;
                           // }
                            //str += ')';
                        }
                        if (str == '') {
                            $('#current_step').hide('fast');
                        } else {
                            $('#current_step').html(str);
                            $('#current_step').show();
                        }
                    }

                    function print_box(str) {
                        if (str == undefined) {
                            var str = '<span>';
                            var r = game.results[game.step];
                            for (var n = 0; n < r.length; n++) {
                                str += r[n] + ' &nbsp;';
                            }
                            str += '</span>';
                        }
                        if (str == '') {
                            $('#print_box').hide('fast');
                        } else {
                            $('#print_box').html(str);
                            $('#print_box').show();
                        }
                    }

                    function show_results() {
                        var str = '';
                        for (var i = game.results.length - 1; i >= 0; i--) {
                            str += '<h2>' + game.prizes[i].name + '</h2>';
                            var r = game.results[i];
                            for (var n = 0; n < r.length; n++) {
                                str += r[n] + ' &nbsp;';
                            }
                            str += '<br/>';
                        }
                        $('#tabs-3').html(str);
                    }


                    function save_setting() {
                        game.reset();

                        var ps = $.trim($('textarea[name=prizes]').val()).split('\n');
                        for (var i = 0; i < ps.length; i++) {
                            var p = $.trim(ps[i]);
                            if (p.length == 0) {
                                continue;
                            }
                            var ex = p.split('|');
                            var prize = {
                                name: $.trim(ex[0]),
                                num: parseInt($.trim(ex[1])),
                                num_a_time: parseInt($.trim(ex[2])),
                                award: $.trim(ex[3])
                            };
                            game.prizes.push(prize);
                        }

                        var ps = $.trim($('textarea[name=candidates]').val()).replace(/,/g, '\n').split('\n');
                        for (var i = 0; i < ps.length; i++) {
                            var p = $.trim(ps[i]);
                            if (p.length == 0) {
                                continue;
                            }
                            game.candidates.push(p);
                        }

                        $('#event_title span').html($('input[name=title]').val());
                        $('#tabs-1').css('background', 'url(' + $('input[name=background_image]').val() + ') center center no-repeat');

                        game.init();
                    }
                </script>
            </div>

        </div>
    </div>
<br>
           <script type="text/javascript"> 
                function btnAction123() {
                    game.process();
                }
           </script>
<div style=" text-align:center;"><input type="button" class="login-button" onclick="btnAction123()" value="回车"/></div>
</body>
</html>
